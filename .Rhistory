OPD_sf$gender,
"<br><b>Age (years):</b> ",
OPD_sf$age,
"<br><b>Date of service:</b> ",
OPD_sf$date3,
"</div>"
)
# Define a custom color palette for years 2018 to 2023
custom_colors <- c("#1F77B4FF", "#FF7F0EFF", "#2CA02CFF", "#D62728FF", "#9467BDFF", "#374649FF")
usethis::use_vignette("SubdistrictCombine")
setwd("D:/My_Research/CrossTalk")
library(sf)
library(dplyr)
library(leaflet)
library(crosstalk)
library(lubridate)
library(htmltools)
library(readxl)
library(devtools)
library(summarywidget)
library(ggplot2)
library(plotly)
library(sp)
# Import Data
CrossTalk_OPD <- read_excel("CrossTalk_OPD.xlsx")
# create DataFrame
OPD_df <- data.frame(lon = CrossTalk_OPD$Longitude, lat = CrossTalk_OPD$Latitude, date = CrossTalk_OPD$date, year = CrossTalk_OPD$Year, gender = CrossTalk_OPD$Sex, age = CrossTalk_OPD$age_n, Month = CrossTalk_OPD$Month)
patients_count <- nrow(OPD_df)
# custom age group
OPD_df$age_group <- cut(OPD_df$age, breaks = c(0, 20, 40, 60, 80, Inf), labels = c("0-20", "21-40", "41-60", "61-80", "81+"), include.lowest = TRUE)
# Make simple lat, lon
OPD_sf <- st_as_sf(OPD_df, coords = c("lon", "lat"), crs = 4326)
# ChangeToDate
OPD_sf <- OPD_sf %>% dplyr::mutate( date2 = as.numeric( as.Date( date ) ), date3 = as.Date( date ))
OPD_sf <- OPD_sf %>%  dplyr::mutate(year = as.character(year))
# Convert TextMonth to ordered factor
OPD_sf$Month <- factor(OPD_sf$Month, levels = month.abb)
# Share Data
shared_dataOPD <- SharedData$new(OPD_sf)
# create Popup
popup_contentOPD <- paste0("<b>Gender:</b> ", OPD_sf$gender,
"<br><b>Age (years):</b> ", OPD_sf$age,
"<br><b>Date of service:</b> ", OPD_sf$date3)
# Define a custom color palette for years 2018 to 2023
custom_colors <- c("#374649FF", "#FF7F0EFF", "#2CA02CFF", "#D62728FF", "#9467BDFF", "#17BECFFF")
htmltools::div(style = "margin: 0% auto; width: 95%;", filter_slider("date", NULL, shared_dataOPD, ~date3, width = "100%"))
leaflet(shared_dataOPD, width = "100%", height = "100%") %>%
addTiles() %>%
addCircleMarkers(
popup = popup_contentOPD,
radius = 3,
color = "black",
fillColor = ~colorFactor(custom_colors, shared_dataOPD$year)(year),
fillOpacity = 1,
weight = 0.8
) %>%
addLegend(
"topright",
title = "Year",
colors = custom_colors,
labels = c("2018", "2019", "2020", "2021", "2022", "2023"),
opacity = 1
) %>%
addScaleBar('bottomleft')
htmltools::div(
class = "value-box",
style = "border-radius: 5px; padding: 5px; width: 500px;",
plotly::subplot(
plotly::ggplotly(
ggplot(shared_dataOPD, aes(x = Month, fill = year)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
)
),
htmltools::div(
class = "inner",
htmltools::div(
class = "value-box bg-primary",
style = "margin-top: 1%; width: 99%; border-radius: 5px; padding: 2.5px; font-size: 16px; font-family: 'Arial', sans-serif; color: black; text-align: center;",
"Number of patients:",
summarywidget(shared_dataOPD, statistic = 'count', column = 'year')
),
htmltools::div(
class = "value-box bg-primary",
style = "margin-top: 1%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("year", "Year of service", shared_dataOPD, ~year, inline = TRUE)
),
htmltools::div(
class = "value-box bg-primary",
style = "margin-top : 1%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
"ðŸ“Œ Description: This data spans from October 2018 to September 2023, plotted on a Geo-Map to visualize the locations of individual patients. Please note that exact patient locations may not be available due to data and searching limitations. Additionally, there is a bar chart showing the monthly count of patients by year to visualize the seasonal pattern of patient counts in this period."
)
)
)
install.packages("GeoTB")
library(GeoTB)
setwd("D:/My_Research/CrossTalk")
library(sf)
library(dplyr)
library(leaflet)
library(crosstalk)
library(lubridate)
library(htmltools)
library(readxl)
library(devtools)
library(summarywidget)
library(ggplot2)
library(plotly)
library(sp)
# Import Data
CrossTalk_OPD <- read_excel("CrossTalk_OPD.xlsx")
# create DataFrame
OPD_df <- data.frame(lon = CrossTalk_OPD$Longitude, lat = CrossTalk_OPD$Latitude, date = CrossTalk_OPD$date, year = CrossTalk_OPD$Year, gender = CrossTalk_OPD$Sex, age = CrossTalk_OPD$age_n, Month = CrossTalk_OPD$Month)
patients_count <- nrow(OPD_df)
# custom age group
OPD_df$age_group <- cut(OPD_df$age, breaks = c(0, 20, 40, 60, 80, Inf), labels = c("0-20", "21-40", "41-60", "61-80", "81+"), include.lowest = TRUE)
# Make simple lat, lon
OPD_sf <- st_as_sf(OPD_df, coords = c("lon", "lat"), crs = 4326)
# ChangeToDate
OPD_sf <- OPD_sf %>% dplyr::mutate( date2 = as.numeric( as.Date( date ) ), date3 = as.Date( date ))
OPD_sf <- OPD_sf %>%  dplyr::mutate(year = as.character(year))
# Convert TextMonth to ordered factor
OPD_sf$Month <- factor(OPD_sf$Month, levels = month.abb)
# Share Data
shared_dataOPD <- SharedData$new(OPD_sf)
# create Popup
popup_contentOPD <- paste0("<b>Gender:</b> ", OPD_sf$gender,
"<br><b>Age (years):</b> ", OPD_sf$age,
"<br><b>Date of service:</b> ", OPD_sf$date3)
# Define a custom color palette for years 2018 to 2023
custom_colors <- c("#374649FF", "#FF7F0EFF", "#2CA02CFF", "#D62728FF", "#9467BDFF", "#17BECFFF")
library(rmarkdown)
library(knitr)
library(htmltools)
devtools::install_github("rstudio/bookdown")
library(bookdown)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
htmltools::HTML('<style>
.dashboard {
position: fixed;
left: 0;
top: 50px;
bottom: 0;
right: 0;
}
.dashboard iframe {
width: 500px;
height: 500px;
border: none;
}
</style>
<div class="dashboard">
<iframe src="https://azz247.github.io/GeoTB/root/MapGeo62.html">
</iframe>
</div>')
htmltools::HTML('<style>
.dashboard {
position: fixed;
left: 0;
top: 50px;
bottom: 0;
right: 0;
}
.dashboard iframe {
width: 600px;
height: 500px;
border: none;
}
</style>
<div class="dashboard">
<iframe src="https://azz247.github.io/GeoTB/root/MapGeo62.html">
</iframe>
</div>')
htmltools::HTML('<style>
.dashboard {
position: fixed;
left: 0;
top: 50px;
bottom: 0;
right: 0;
}
.dashboard iframe {
width: 600px;
height: 600px;
border: none;
}
</style>
<div class="dashboard">
<iframe src="https://azz247.github.io/GeoTB/root/MapGeo62.html">
</iframe>
</div>')
library(leaflet)
library(htmltools)
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
leaflet(shared_dataOPD, width = "100%", height = "100%") %>%
addTiles() %>%
addCircleMarkers(
popup = popup_contentOPD,
radius = 3,
color = "black",
fillColor = ~colorFactor(custom_colors, shared_dataOPD$year)(year),
fillOpacity = 1,
weight = 0.8
) %>%
addLegend(
"topright",
title = "Year",
colors = custom_colors,
labels = c("2018", "2019", "2020", "2021", "2022", "2023"),
opacity = 1
) %>%
addScaleBar('bottomleft')
pkgdown::build_site()
('<style>
.dashboard {
left: 0;
top: 0;
bottom: 0;
right: 0;
}
.dashboard iframe {
width: 500px;
height: 500px;
border: none;
}
</style>
<div class="dashboard">
<iframe src="https://azz247.github.io/GeoTB/root/MapGeo62.html">
</iframe>
</div>')
htmltools::HTML('<style>
.dashboard {
left: 0;
top: 0;
bottom: 0;
right: 0;
}
.dashboard iframe {
width: 500px;
height: 500px;
border: none;
}
</style>
<div class="dashboard">
<iframe src="https://azz247.github.io/GeoTB/root/MapGeo62.html">
</iframe>
</div>')
htmltools::HTML('<style>
.dashboard {
left: 0;
top: 0;
bottom: 0;
right: 0;
}
.dashboard iframe {
width: 800px;
height: 500px;
border: none;
}
</style>
<div class="dashboard">
<iframe src="https://azz247.github.io/GeoTB/root/MapGeo62.html">
</iframe>
</div>')
pkgdown::build_site()
?fig_chunk
pkgdown::build_site()
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
setwd("D:/My_Research/Chart_TB")
library(ggpubr)
library(ggplot2)
library(readxl)
library(tidyverse)
# import data
NumberOfPateint <- read_excel("NumberOfPateint.xlsx")
View(NumberOfPateint)
NumberDF <- data.frame(year = NumberOfPateint$years, Total = NumberOfPateint$Sum_patient, Male = NumberOfPateint$Sum_Male,
Female = NumberOfPateint$Sum_Female,AD_year = NumberOfPateint$AD_Years)
NumberDF$Sex_NA <- NumberDF$Total - (NumberDF$Male+NumberDF$Female)
NumberDF$OPDMale <- NumberOfPateint$Male_OPD
NumberDF$OPDFemale <- NumberOfPateint$Female_OPD
NumberDF$TotalOPD_sex <- NumberDF$OPDMale + NumberDF$OPDFemale
NumberDF$IPDMale <- NumberOfPateint$Male_IPD
NumberDF$IPDFemale <- NumberOfPateint$Female_IPD
NumberDF$TotalIPD_sex <- NumberDF$IPDMale + NumberDF$IPDFemale
NumberDF$IPD <- NumberOfPateint$IPD
NumberDF$OPD <- NumberOfPateint$OPD
View(NumberDF)
NumberDF %>%
ggplot(aes(x = year)) +
geom_point(aes(y = Total, color = "Total"), size = 5, alpha = 0.3) +
geom_line(aes(y = Total, color = "Total"), size = 1, linejoin = "round", lineend = "round") +
geom_text(aes(label = Total, y = Total), vjust = -1, hjust = 0.5, size = 3.1) +
geom_line(aes(y = Female, color = "Female"), size = 1, linetype = "dashed") +
geom_point(aes(y = Female, color = "Female"), size = 5, alpha = 0.3) +
geom_text(aes(label = Female, y = Female), vjust = -1, hjust = 0.5, size = 3) +
geom_line(aes(y = Male, color = "Male"), size = 1, linetype = "dashed") +
geom_point(aes(y = Male, color = "Male"), size = 5, alpha = 0.3) +
geom_text(aes(label = Male, y = Male), vjust = -1, hjust = 0.5, size = 3) +
theme_bw() +
labs(title = "Trend of number of patients", x = "Years", y = "Number of patients") +
scale_x_continuous(breaks = unique(NumberDF$year)) +
scale_color_manual(values = c("Total" = "green4","Female" = "red", "Male" = "blue")) +
guides(color = guide_legend(title = NULL)) +
theme(plot.title = element_text(hjust = 0.5))
NumberDF %>%
ggplot(aes(year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 1, linejoin = "round", lineend = "round") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.5, size = 3.1) +
theme_bw() +
labs(title = "Trend of number of patients", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$year)) +
theme(plot.title = element_text(hjust = 0.5))
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 1, linejoin = "round", lineend = "round") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.5, size = 3.1) +
theme_bw() +
labs(title = "Trend of number of patients", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$year)) +
theme(plot.title = element_text(hjust = 0.5))
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 1, linejoin = "round", lineend = "round") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.5, size = 3.1) +
theme_bw() +
labs(title = "Trend of number of patients", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 1, linejoin = "round", lineend = "round") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.5, size = 3.1) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 1, linejoin = "round", lineend = "round",colour = "blue") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.5, size = 3.1) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 0.8, linejoin = "round", lineend = "round",colour = "blue") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.5, size = 3.1) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 0.5, linejoin = "round", lineend = "round",colour = "blue") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.5, size = 3.1) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
# Line Chart Summary by OPD&IPD
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 0.7, linejoin = "round", lineend = "round",colour = "blue") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.5, size = 3.1) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 0.7, linejoin = "round", lineend = "round",colour = "blue") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.5, size = 3.1) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 1, linejoin = "round", lineend = "round",colour = "blue") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.5, size = 3.1) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 1, linejoin = "round", lineend = "round",colour = "blue") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.5, size = 3.5) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 1, linejoin = "round", lineend = "round",colour = "blue") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.5, size = 3.2) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 1, linejoin = "round", lineend = "round",colour = "green4") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.5, size = 3.5) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 1, linejoin = "round", lineend = "round",colour = "blue") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.5, size = 3.5) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
# Line Chart Summary by OPD&IPD
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 1, linejoin = "round", lineend = "round",colour = "blue") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.7, size = 3.5) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
# Line Chart Summary by OPD&IPD
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 1, linejoin = "round", lineend = "round",colour = "blue") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 1, size = 3.5) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
# Line Chart Summary by OPD&IPD
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 1, linejoin = "round", lineend = "round",colour = "blue") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.2, size = 3.5) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
# Line Chart Summary by OPD&IPD
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 1, linejoin = "round", lineend = "round",colour = "blue") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.4, size = 3.5) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
# Line Chart Summary by OPD&IPD
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 1, linejoin = "round", lineend = "round",colour = "blue") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.45, size = 3.5) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
# Line Chart Summary by OPD&IPD
NumberDF %>%
ggplot(aes(AD_year, Total)) +
geom_point(size = 5, alpha = 0.3, colour = "red") +
geom_line(aes(y = Total), size = 1, linejoin = "round", lineend = "round",colour = "blue") +
geom_text(aes(label = Total), vjust = 1.8, hjust = 0.5, size = 3.5) +
theme_bw() +
labs(title = " ", x = "Years", y = "Number of patients(Person)") +
scale_x_continuous(breaks = unique(NumberDF$AD_year)) +
theme(plot.title = element_text(hjust = 0.5))
pkgdown::build_site()
