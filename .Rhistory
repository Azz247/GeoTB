class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("gender", "Gender", shared_dataOPD, ~gender, inline = TRUE)
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("age", "Age group (years)", shared_dataOPD, ~age_group, inline = TRUE)
)
)
)
setwd("D:/My_Research/CrossTalk")
library(sf)
library(dplyr)
library(leaflet)
library(crosstalk)
library(lubridate)
library(htmltools)
library(readxl)
library(devtools)
library(summarywidget)
library(ggplot2)
library(plotly)
library(sp)
# Import Data
CrossTalk_OPD <- read_excel("CrossTalk_OPD.xlsx")
# create DataFrame
OPD_df <- data.frame(lon = CrossTalk_OPD$Longitude, lat = CrossTalk_OPD$Latitude, date = CrossTalk_OPD$date, year = CrossTalk_OPD$Year, gender = CrossTalk_OPD$Sex, age = CrossTalk_OPD$age_n, Month = CrossTalk_OPD$Month)
patients_count <- nrow(OPD_df)
# custom age group
OPD_df$age_group <- cut(OPD_df$age, breaks = c(0, 20, 40, 60, 80, Inf), labels = c("0-20", "21-40", "41-60", "61-80", "81+"), include.lowest = TRUE)
# Make simple lat, lon
OPD_sf <- st_as_sf(OPD_df, coords = c("lon", "lat"), crs = 4326)
# ChangeToDate
OPD_sf <- OPD_sf %>% dplyr::mutate( date2 = as.numeric( as.Date( date ) ), date3 = as.Date( date ))
OPD_sf <- OPD_sf %>%  dplyr::mutate(year = as.character(year))
# Convert TextMonth to ordered factor
OPD_sf$Month <- factor(OPD_sf$Month, levels = month.abb)
# Share Data
shared_dataOPD <- SharedData$new(OPD_sf)
# create Popup
popup_contentOPD <- paste0("<b>Gender:</b> ", OPD_sf$gender,
"<br><b>Age (years):</b> ", OPD_sf$age,
"<br><b>Date of service:</b> ", OPD_sf$date3)
# Define a custom color palette for years 2018 to 2023
custom_colors <- c("cyan","#458B00" ,"#FF00F0", "#FFA500","#FF0000" ,"#0000FF")
custom_colors2 <- c("#0000FF","#FF0000","#458B00" ,"#FF00F0")
custom_colors3 <- c("#0000FF","cyan4","#458B00" ,"#FF00F0","#FFA500","#FF0000")
htmltools::div(
class = "value-box",
style = "border-radius: 5px; padding: 5px; width: 700px;",
plotly::subplot(
plotly::ggplotly(
ggplot(shared_dataOPD, aes(x = Month, fill = year)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
)
),
htmltools::div(
class = "inner",
htmltools::div(
class = "value-box bg-primary",
style = "margin-top: 0.3%; width: 99%; border-radius: 5px; padding: 2.5px; font-size: 16px; font-family: 'Arial', sans-serif; color: black; text-align: center;",
"Number of patients:",
summarywidget(shared_dataOPD, statistic = 'count', column = 'year')
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("year", "Year of service", shared_dataOPD, ~year, inline = TRUE)
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("month","Month",shared_dataOPD,~Month, inline = TRUE)
)
)
)
htmltools::div(
class = "value-box",
style = "border-radius: 5px; padding: 5px; width: 500px;",
plotly::subplot(
plotly::ggplotly(
ggplot(shared_dataOPD, aes(x = Month, fill = year)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
)
),
htmltools::div(
class = "inner",
htmltools::div(
class = "value-box bg-primary",
style = "margin-top: 0.3%; width: 99%; border-radius: 5px; padding: 2.5px; font-size: 16px; font-family: 'Arial', sans-serif; color: black; text-align: center;",
"Number of patients:",
summarywidget(shared_dataOPD, statistic = 'count', column = 'year')
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("year", "Year of service", shared_dataOPD, ~year, inline = TRUE)
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("month","Month",shared_dataOPD,~Month, inline = TRUE)
)
)
)
htmltools::div(
class = "value-box",
style = "border-radius: 5px; padding: 5px; width: 500px;",
plotly::subplot(
plotly::ggplotly(
ggplot(shared_dataOPD, aes(x = Month, fill = year)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
)
),
htmltools::div(
class = "inner",
htmltools::div(
class = "value-box bg-primary",
style = "margin-top: 0.3%; width: 99%; border-radius: 5px; padding: 2.5px; font-size: 16px; font-family: 'Arial', sans-serif; color: black; text-align: center;",
"Number of patients:",
summarywidget(shared_dataOPD, statistic = 'count', column = 'year')
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("year", "Year of service", shared_dataOPD, ~year, inline = TRUE)
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("month","Month",shared_dataOPD,~Month, inline = TRUE)
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("gender", "Gender", shared_dataOPD, ~gender, inline = TRUE)
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("age", "Age group (years)", shared_dataOPD, ~age_group, inline = TRUE)
)
)
)
htmltools::div(
class = "value-box",
style = "border-radius: 5px; padding: 5px; width: 500px;",
plotly::subplot(
plotly::ggplotly(
ggplot(shared_dataOPD, aes(x = Month, fill = year)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
)
),
htmltools::div(
class = "inner",
htmltools::div(
class = "value-box bg-primary",
style = "margin-top: 0.3%; width: 99%; border-radius: 5px; padding: 2.5px; font-size: 16px; font-family: 'Arial', sans-serif; color: black; text-align: center;",
"Number of patients:",
summarywidget(shared_dataOPD, statistic = 'count', column = 'year')
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("year", "Year of service", shared_dataOPD, ~year, inline = TRUE)
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("month","Month",shared_dataOPD,~Month, inline = TRUE)
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("age", "Age group (years)", shared_dataOPD, ~age_group, inline = TRUE)
)
)
)
htmltools::div(
class = "value-box",
style = "border-radius: 5px; padding: 5px; width: 500px;",
plotly::subplot(
plotly::ggplotly(
ggplot(shared_dataOPD, aes(x = Month, fill = year)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
),
plotly::ggplotly(
ggplot(shared_dataOPD, aes(x = Month, fill = age_group)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
),
nrows = 2
),
htmltools::div(
class = "inner",
htmltools::div(
class = "value-box bg-primary",
style = "margin-top: 0.3%; width: 99%; border-radius: 5px; padding: 2.5px; font-size: 16px; font-family: 'Arial', sans-serif; color: black; text-align: center;",
"Number of patients:",
summarywidget(shared_dataOPD, statistic = 'count', column = 'year')
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("year", "Year of service", shared_dataOPD, ~year, inline = TRUE)
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("month","Month",shared_dataOPD,~Month, inline = TRUE)
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("age", "Age group (years)", shared_dataOPD, ~age_group, inline = TRUE)
)
)
)
htmltools::div(
class = "value-box",
style = "border-radius: 5px; padding: 5px; width: 500px;",
plotly::subplot(
plotly::ggplotly(
ggplot(shared_dataOPD, aes(x = Month, fill = year)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
),
plotly::ggplotly(
ggplot(shared_dataOPD, aes(x = Month, fill = age_group)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
),
nrows = 2
),
htmltools::div(
class = "inner",
htmltools::div(
class = "value-box bg-primary",
style = "margin-top: 0.3%; width: 99%; border-radius: 5px; padding: 2.5px; font-size: 16px; font-family: 'Arial', sans-serif; color: black; text-align: center;",
"Number of patients:",
summarywidget(shared_dataOPD, statistic = 'count', column = 'year')
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("year", "Year of service", shared_dataOPD, ~year, inline = TRUE)
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("age", "Age group (years)", shared_dataOPD, ~age_group, inline = TRUE)
)
)
)
htmltools::div(
class = "value-box",
style = "border-radius: 5px; padding: 5px; width: 500px;",
plotly::subplot(
plotly::ggplotly(
ggplot(shared_dataOPD, aes(x = Month, fill = year)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
)
),
htmltools::div(
class = "inner",
htmltools::div(
class = "value-box bg-primary",
style = "margin-top: 0.3%; width: 99%; border-radius: 5px; padding: 2.5px; font-size: 16px; font-family: 'Arial', sans-serif; color: black; text-align: center;",
"Number of patients:",
summarywidget(shared_dataOPD, statistic = 'count', column = 'year')
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("year", "Year of service", shared_dataOPD, ~year, inline = TRUE)
)
)
)
htmltools::div(
class = "value-box",
style = "border-radius: 5px; padding: 5px; width: 500px;",
plotly::subplot(
plotly::ggplotly(
ggplot(shared_dataOPD, aes(y = Month, fill = year)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
)
),
htmltools::div(
class = "inner",
htmltools::div(
class = "value-box bg-primary",
style = "margin-top: 0.3%; width: 99%; border-radius: 5px; padding: 2.5px; font-size: 16px; font-family: 'Arial', sans-serif; color: black; text-align: center;",
"Number of patients:",
summarywidget(shared_dataOPD, statistic = 'count', column = 'year')
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("year", "Year of service", shared_dataOPD, ~year, inline = TRUE)
)
)
)
htmltools::div(
class = "value-box",
style = "border-radius: 5px; padding: 5px; width: 500px;",
plotly::subplot(
plotly::ggplotly(
ggplot(shared_dataOPD, aes(x = Month, fill = year)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
)
),
htmltools::div(
class = "inner",
htmltools::div(
class = "value-box bg-primary",
style = "margin-top: 0.3%; width: 99%; border-radius: 5px; padding: 2.5px; font-size: 16px; font-family: 'Arial', sans-serif; color: black; text-align: center;",
"Number of patients:",
summarywidget(shared_dataOPD, statistic = 'count', column = 'year')
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("year", "Year of service", shared_dataOPD, ~year, inline = TRUE)
)
)
)
htmltools::div(
class = "value-box",
style = "border-radius: 5px; padding: 5px; width: 500px;",
plotly::subplot(
plotly::ggplotly(
ggplot(shared_dataOPD, aes(x = Month, fill = year)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
)
),
htmltools::div(
class = "inner",
htmltools::div(
class = "value-box bg-primary",
style = "margin-top: 0.3%; width: 99%; border-radius: 5px; padding: 2.5px; font-size: 16px; font-family: 'Arial', sans-serif; color: black; text-align: center;",
"Number of patients:",
summarywidget(shared_dataOPD, statistic = 'count', column = 'year')
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("year", "Year of service", shared_dataOPD, ~year, inline = TRUE)
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("age", "Age group (years)", shared_dataOPD, ~age_group, inline = TRUE)
)
)
)
htmltools::div(
class = "value-box",
style = "border-radius: 5px; padding: 5px; width: 500px;",
plotly::subplot(
plotly::ggplotly(
ggplot(shared_dataOPD, aes(x = Month, fill = year)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
)
),
htmltools::div(
class = "inner",
htmltools::div(
class = "value-box bg-primary",
style = "margin-top: 0.3%; width: 99%; border-radius: 5px; padding: 2.5px; font-size: 16px; font-family: 'Arial', sans-serif; color: black; text-align: center;",
"Number of patients:",
summarywidget(shared_dataOPD, statistic = 'count', column = 'year')
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("year", "Year of service", shared_dataOPD, ~year, inline = TRUE)
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("age", "Age group (years)", shared_dataOPD, ~Month, inline = TRUE)
)
)
)
htmltools::div(
class = "value-box",
style = "border-radius: 5px; padding: 5px; width: 500px;",
plotly::subplot(
plotly::ggplotly(
ggplot(shared_dataOPD, aes(x = Month, fill = year)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
)
),
htmltools::div(
class = "inner",
htmltools::div(
class = "value-box bg-primary",
style = "margin-top: 0.3%; width: 99%; border-radius: 5px; padding: 2.5px; font-size: 16px; font-family: 'Arial', sans-serif; color: black; text-align: center;",
"Number of patients:",
summarywidget(shared_dataOPD, statistic = 'count', column = 'year')
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("year", "Year of service", shared_dataOPD, ~year, inline = TRUE)
)
)
)
htmltools::div(
class = "value-box",
style = "border-radius: 5px; padding: 5px; width: 500px;",
plotly::subplot(
plotly::ggplotly(
ggplot(shared_dataOPD, aes(x = Month, fill = year)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
)
),
htmltools::div(
class = "inner",
htmltools::div(
class = "value-box bg-primary",
style = "margin-top: 0.3%; width: 99%; border-radius: 5px; padding: 2.5px; font-size: 16px; font-family: 'Arial', sans-serif; color: black; text-align: center;",
"Number of patients:",
summarywidget(shared_dataOPD, statistic = 'count', column = 'year')
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("year", "Year of service", shared_dataOPD, ~year, inline = TRUE)
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
"Description: This is data from October 2018 to September 2023 plot on Map and Barchart"
)
)
)
htmltools::div(
class = "value-box",
style = "border-radius: 5px; padding: 5px; width: 500px;",
plotly::subplot(
plotly::ggplotly(
ggplot(shared_dataOPD, aes(x = Month, fill = year)) +
geom_bar(position = "dodge") +
scale_fill_manual(values = custom_colors) +
labs(x = "Month", y = "Count", title = "Monthly Count of Patients by Year") +
theme(legend.position = 'none')
)
),
htmltools::div(
class = "inner",
htmltools::div(
class = "value-box bg-primary",
style = "margin-top: 0.3%; width: 99%; border-radius: 5px; padding: 2.5px; font-size: 16px; font-family: 'Arial', sans-serif; color: black; text-align: center;",
"Number of patients:",
summarywidget(shared_dataOPD, statistic = 'count', column = 'year')
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
filter_checkbox("year", "Year of service", shared_dataOPD, ~year, inline = TRUE)
),
htmltools::div(
class = "value-box bg-primary",
style = "margin: 0.3%; width: 99%; border-radius: 5px; padding: 10px; color: black;",
"Description: This data spans from October 2018 to September 2023, plotted on a Geo-Map to visualize the locations of individual patients. Please note that exact patient locations may not be available due to data and searching limitations. Additionally, there is a bar chart showing the monthly count of patients by year to visualize the seasonal pattern of patient counts."
)
)
)
